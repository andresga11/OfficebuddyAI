{"ast":null,"code":"import React,{useState}from\"react\";import{Title}from\"./title\";import axios from\"axios\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";var userInput=\"\";const formatObjectForDisplay=(obj,prefix='')=>{const formatEntry=(key,value)=>{if(typeof value==='object'&&value!==null&&!Array.isArray(value)){return`${prefix}${key}: {\\n${formatObjectForDisplay(value,prefix+'  ')}\\n${prefix}}`;}else if(Array.isArray(value)){return`${prefix}${key}: [\\n${value.map(v=>formatObjectForDisplay(v,prefix+'  ')).join(',\\n')}\\n${prefix}]`;}else{return`${prefix}${key}: ${value}`;}};return Object.entries(obj).map(([key,value])=>formatEntry(key,value)).join('\\n'+prefix);};export const Chatbot=({handleLogout})=>{const[messages,setMessages]=useState([]);const[input,setInput]=useState(\"\");const[sqlStatement,setSqlStatement]=useState('');const[embedding,setEmbedding]=useState('');const handleInputChange=event=>{setInput(event.target.value);};const handleSend=()=>{const newMessages=[...messages,{text:input,from:\"user\"}];setMessages(newMessages);userInput=input;setInput(\"\");axios.post(`http://localhost:3005/api/vectordb/get_data`,{input}).then(res=>{const formattedData=res.data.bot.map(obj=>formatObjectForDisplay(obj)).join(\"\\n\\n\");const botResponse={text:formattedData,from:\"bot\"};setSqlStatement(res.data.sql);setEmbedding(res.data.embedding);setMessages([...newMessages,botResponse,{text:\"Was the data displayed correctly?\",from:\"feedback\"}]);}).catch(error=>{console.error(\"Error\",error);alert(\"Sorry, can you try again?\");});};const handleFeedback=async feedback=>{try{await axios.post(`http://localhost:3005/api/vectordb/feedback`,{userInput:userInput,sqlStatement:sqlStatement,feedback:feedback,embedding:embedding}).then(res=>{alert(res.data.message);});}catch(error){console.error('Error:',error);alert('Failed to record feedback.');}};return _jsxs(\"div\",{className:\"chat-container\",children:[_jsx(\"h6\",{children:_jsx(Title,{handleLogout:handleLogout})}),_jsx(\"div\",{className:\"chat-history\",children:messages.map((msg,index)=>{if(msg.from===\"feedback\"){return _jsxs(\"div\",{children:[_jsx(\"br\",{}),_jsx(\"p\",{className:\"message bot\",children:msg.text}),_jsx(\"button\",{className:\"feedback-button\",onClick:()=>handleFeedback(\"YES\"),children:\"Yes\"}),_jsx(\"button\",{className:\"feedback-button\",onClick:()=>handleFeedback(\"NO\"),children:\"No\"}),_jsx(\"br\",{}),_jsx(\"br\",{}),_jsx(\"hr\",{})]},index);}else{return _jsxs(\"div\",{children:[_jsx(\"br\",{}),_jsx(\"p\",{className:`message ${msg.from}`,children:msg.text},index),\")\",_jsx(\"hr\",{})]});}})}),_jsxs(\"div\",{className:\"input-button-container\",children:[_jsx(\"input\",{className:\"input-area\",type:\"text\",value:input,onChange:handleInputChange,placeholder:\"Type a message...\"}),_jsx(\"button\",{className:\"chat-button\",onClick:handleSend,children:\"Send\"})]})]});};","map":{"version":3,"names":["React","useState","Title","axios","jsx","_jsx","jsxs","_jsxs","userInput","formatObjectForDisplay","obj","prefix","formatEntry","key","value","Array","isArray","map","v","join","Object","entries","Chatbot","handleLogout","messages","setMessages","input","setInput","sqlStatement","setSqlStatement","embedding","setEmbedding","handleInputChange","event","target","handleSend","newMessages","text","from","post","then","res","formattedData","data","bot","botResponse","sql","catch","error","console","alert","handleFeedback","feedback","message","className","children","msg","index","onClick","type","onChange","placeholder"],"sources":["/Users/andresga11/Desktop/OfficebuddyAI/client/src/chatbot.jsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport { Title } from \"./title\";\nimport axios from \"axios\";\nvar userInput = \"\"\n\nconst formatObjectForDisplay = (obj, prefix = '') => {\n  const formatEntry = (key, value) => {\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      return `${prefix}${key}: {\\n${formatObjectForDisplay(value, prefix + '  ')}\\n${prefix}}`;\n    } else if (Array.isArray(value)) {\n      return `${prefix}${key}: [\\n${value.map(v => formatObjectForDisplay(v, prefix + '  ')).join(',\\n')}\\n${prefix}]`;\n    } else {\n      return `${prefix}${key}: ${value}`;\n    }\n  };\n  return Object.entries(obj).map(([key, value]) => formatEntry(key, value)).join('\\n' + prefix);\n};\n\nexport const Chatbot = ({ handleLogout }) => {\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const [sqlStatement, setSqlStatement] = useState('');\n  const [embedding, setEmbedding] = useState('');\n\n\n  const handleInputChange = (event) => {\n    setInput(event.target.value);\n  };\n\n  const handleSend = () => {\n    const newMessages = [...messages, { text: input, from: \"user\" }];\n    setMessages(newMessages);\n    userInput = input;\n    setInput(\"\");\n\n    axios\n      .post(`http://localhost:3005/api/vectordb/get_data`, { input })\n      .then((res) => {\n        const formattedData = res.data.bot.map(obj => formatObjectForDisplay(obj)).join(\"\\n\\n\");\n        const botResponse = { text: formattedData, from: \"bot\" };\n        setSqlStatement(res.data.sql);\n        setEmbedding(res.data.embedding);\n        setMessages([...newMessages, botResponse, { text: \"Was the data displayed correctly?\", from: \"feedback\" }]);\n      })\n      .catch((error) => {\n        console.error(\"Error\", error);\n        alert(\"Sorry, can you try again?\");\n      });\n  };\n\n  const handleFeedback = async (feedback) => {\n    try {\n      await axios.post(`http://localhost:3005/api/vectordb/feedback`, {\n        userInput: userInput,\n        sqlStatement: sqlStatement,\n        feedback: feedback, \n        embedding: embedding\n      })\n      .then((res) => {\n        alert(res.data.message);\n      })\n      \n    } catch (error) {\n      console.error('Error:', error);\n      alert('Failed to record feedback.');\n    }\n  };\n\n  return (\n    <div className=\"chat-container\">\n      <h6>\n        <Title handleLogout={handleLogout} />\n      </h6>\n\n      <div className=\"chat-history\">\n        {messages.map((msg, index) => {\n          if (msg.from === \"feedback\") {\n            return (\n              <div key={index}>\n                <br />\n                <p className=\"message bot\">{msg.text}</p>\n                <button className=\"feedback-button\" onClick={() => handleFeedback(\"YES\")}>Yes</button>\n                <button className=\"feedback-button\" onClick={() => handleFeedback(\"NO\")}>No</button>\n                <br />\n                <br />\n                <hr />              \n              </div>\n            );\n          } else {\n            return (\n            <div>\n              <br />\n              <p key={index} className={`message ${msg.from}`}>{msg.text}</p>)\n              <hr />\n            </div>\n        );\n        }\n        })}\n      </div>\n      <div className=\"input-button-container\">\n        <input className=\"input-area\"\n          type=\"text\"\n          value={input}\n          onChange={handleInputChange}\n          placeholder=\"Type a message...\"\n        />\n        <button className=\"chat-button\" onClick={handleSend}>\n          Send\n        </button>\n      </div>\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}